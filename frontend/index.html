<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Minecraft Vita Skinpack Manager</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; }
  h1 { text-align: center; }
  form { margin-bottom: 30px; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
  label { display: block; margin-top: 10px; }
  input[type=text], input[type=file] { width: 100%; padding: 6px; margin-top: 4px; }
  button { margin-top: 10px; padding: 10px 20px; }
  .pack { display: flex; align-items: center; margin-bottom: 15px; }
  .pack img { width: 64px; height: 64px; object-fit: cover; margin-right: 15px; border: 1px solid #ccc; }
</style>
</head>
<body>

<h1>Minecraft Vita Skinpack Manager</h1>

<form id="uploadForm">
  <label for="name">Skinpack Name</label>
  <input type="text" id="name" name="name" required>

  <label for="thumbnail">Thumbnail (.png or .jpg) â€” optional</label>
  <input type="file" id="thumbnail" name="thumbnail" accept=".png,.jpg">

  <label for="pck">Skinpack .pck file</label>
  <input type="file" id="pck" name="file" accept=".pck" required>

  <button type="submit">Upload Skinpack</button>
</form>

<h2>Uploaded Skinpacks</h2>
<div id="packsList"></div>

<script>
const backendURL = "https://minecraft-vita-server-production.up.railway.app";
const defaultThumbnail = "default_thumbnail.png"; // relative path in frontend folder

async function fetchPacks() {
    const res = await fetch(`${backendURL}/list`);
    const packs = await res.json();

    const listDiv = document.getElementById("packsList");
    listDiv.innerHTML = "";

    packs.forEach(pack => {
        const div = document.createElement("div");
        div.className = "pack";

        const img = document.createElement("img");
        img.src = pack.thumbnail ? (backendURL + pack.thumbnail) : defaultThumbnail;
        div.appendChild(img);

        const name = document.createElement("div");
        name.innerHTML = `<strong>${pack.name}</strong><br>
                          <a href="${backendURL + pack.pck}" target="_blank">Download .pck</a>`;
        div.appendChild(name);

        listDiv.appendChild(div);
    });
}

// Handle upload
document.getElementById("uploadForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData();
    formData.append("name", document.getElementById("name").value);

    const thumbFile = document.getElementById("thumbnail").files[0];
    if (thumbFile) formData.append("thumbnail", thumbFile);

    formData.append("file", document.getElementById("pck").files[0]);

    const res = await fetch(`${backendURL}/upload`, {
        method: "POST",
        body: formData
    });

    const data = await res.json();
    if(data.success){
        alert("Upload successful!");
        document.getElementById("uploadForm").reset();
        fetchPacks();
    } else {
        alert("Upload failed: " + (data.error || "Unknown error"));
    }
});

// Initial fetch
fetchPacks();
</script>

</body>
</html>
